<div class="workouts-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="page-title">
          <mat-icon class="title-icon">fitness_center</mat-icon>
          Qu·∫£n L√Ω Bu·ªïi T·∫≠p
        </h1>
        <p class="page-subtitle">Ghi l·∫°i v√† theo d√µi c√°c bu·ªïi t·∫≠p luy·ªán c·ªßa b·∫°n</p>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="accent" class="quick-add-btn" (click)="showQuickAdd = !showQuickAdd">
          <mat-icon>{{ showQuickAdd ? 'close' : 'add' }}</mat-icon>
          {{ showQuickAdd ? 'ƒê√≥ng' : 'Ghi Nhanh' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Quick Add Form -->
    <div class="quick-add-section" *ngIf="showQuickAdd">
      <div class="form-card">
        <div class="form-header">
          <h2 class="form-title">
            <mat-icon>add_circle</mat-icon>
            Ghi Nhanh Bu·ªïi T·∫≠p
          </h2>
          <p class="form-subtitle">ƒêi·ªÅn th√¥ng tin ƒë·ªÉ ghi l·∫°i bu·ªïi t·∫≠p m·ªõi</p>
        </div>

        <form class="workout-form">
          <div class="form-row">
            <div class="form-group">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>
                  <mat-icon class="field-icon">fitness_center</mat-icon>
                  Ph√≤ng Gym
                </mat-label>
                <mat-select [(ngModel)]="form.gym" name="gymId" placeholder="Ch·ªçn ph√≤ng gym" (selectionChange)="onGymChange($event.value)">
                  <mat-option [value]="''" disabled>Ch·ªçn ph√≤ng gym</mat-option>
                  <mat-option *ngFor="let g of gyms" [value]="g._id">{{ g.name }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>
                  <mat-icon class="field-icon">build</mat-icon>
                  Thi·∫øt B·ªã
                </mat-label>
                <mat-select [(ngModel)]="form.items[0].equipment" name="eqId" placeholder="Ch·ªçn thi·∫øt b·ªã" [disabled]="!equipment.length">
                  <mat-option [value]="''" disabled>Ch·ªçn thi·∫øt b·ªã</mat-option>
                  <mat-option *ngFor="let e of equipment" [value]="e._id">{{ e.name || e._id }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div class="form-row exercise-details">
            <div class="form-group">
              <mat-form-field appearance="outline">
                <mat-label>
                  <mat-icon class="field-icon">repeat</mat-icon>
                  S·ªë Hi·ªáp
                </mat-label>
                <input matInput type="number" [(ngModel)]="form.items[0].sets" name="sets" placeholder="3" />
              </mat-form-field>
            </div>
            <div class="form-group">
              <mat-form-field appearance="outline">
                <mat-label>
                  <mat-icon class="field-icon">fitness_center</mat-icon>
                  S·ªë L·∫ßn L·∫∑p
                </mat-label>
                <input matInput type="number" [(ngModel)]="form.items[0].reps" name="reps" placeholder="12" />
              </mat-form-field>
            </div>
          </div>

          <div class="form-actions">
            <button mat-raised-button color="primary" class="save-btn" (click)="create()">
              <mat-icon>save</mat-icon>
              L∆∞u Bu·ªïi T·∫≠p
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Workout History -->
    <div class="history-section">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>history</mat-icon>
          L·ªãch S·ª≠ Bu·ªïi T·∫≠p
        </h2>
        <div class="stats-summary" *ngIf="workouts.length">
          <div class="stat-item">
            <span class="stat-number">{{ workouts.length }}</span>
            <span class="stat-label">Bu·ªïi t·∫≠p</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getTotalExercises() }}</span>
            <span class="stat-label">B√†i t·∫≠p</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getTotalSets() }}</span>
            <span class="stat-label">Hi·ªáp t·∫≠p</span>
          </div>
        </div>
      </div>

      <!-- Workout List -->
      <div class="workout-list" *ngIf="workouts.length">
        <div class="workout-card" *ngFor="let workout of workouts; trackBy: trackByWorkoutId">
          <div class="workout-header">
            <div class="workout-date">
              <div class="date-icon">
                <mat-icon>event</mat-icon>
              </div>
              <div class="date-info">
                <h3 class="workout-title">Bu·ªïi t·∫≠p {{ workout.startedAt | date:'dd/MM/yyyy' }}</h3>
                <p class="workout-time">{{ workout.startedAt | date:'HH:mm' }}</p>
              </div>
            </div>
            <div class="workout-status">
              <span class="status-badge completed">Ho√†n th√†nh</span>
              <button mat-stroked-button color="primary" (click)="openDetail(workout._id)">
                <mat-icon>visibility</mat-icon>
                Xem chi ti·∫øt
              </button>
            </div>
          </div>

          <div class="workout-exercises">
            <div class="exercise-item" *ngFor="let item of workout.items; let i = index">
              <div class="exercise-icon">üí™</div>
              <div class="exercise-info">
                <h4 class="exercise-name">{{ item.equipment?.name || item.equipment }}</h4>
                <div class="exercise-details">
                  <span class="detail-tag">
                    <mat-icon>repeat</mat-icon>
                    {{ item.sets }} hi·ªáp
                  </span>
                  <span class="detail-tag">
                    <mat-icon>fitness_center</mat-icon>
                    {{ item.reps }} l·∫ßn
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!workouts.length">
        <div class="empty-icon">üí™</div>
        <h3 class="empty-title">Ch∆∞a c√≥ bu·ªïi t·∫≠p n√†o</h3>
        <p class="empty-description">
          B·∫Øt ƒë·∫ßu ghi l·∫°i bu·ªïi t·∫≠p ƒë·∫ßu ti√™n ƒë·ªÉ theo d√µi ti·∫øn ƒë·ªô c·ªßa b·∫°n
        </p>
        <button mat-raised-button color="primary" class="empty-action" (click)="showQuickAdd = true">
          <mat-icon>add</mat-icon>
          Ghi Bu·ªïi T·∫≠p ƒê·∫ßu Ti√™n
        </button>
      </div>
    </div>
  </div>

  <ng-template #workoutDetailTpl>
    <div class="detail-dialog">
      <h2 mat-dialog-title>
        <mat-icon>visibility</mat-icon>
        Chi ti·∫øt bu·ªïi t·∫≠p
      </h2>
      <div mat-dialog-content *ngIf="selectedWorkout as d">
        <div class="detail-section">
          <h3>Ph√≤ng Gym</h3>
          <ng-container *ngIf="d.gym as g; else noGymTpl">
            <p><strong>T√™n:</strong> {{ (g?.name) || g }}</p>
            <p *ngIf="g?.address"><strong>ƒê·ªãa ch·ªâ:</strong> {{ g?.address }}</p>
          </ng-container>
          <ng-template #noGymTpl>
            <p><em>Ch∆∞a g·∫Øn ph√≤ng gym cho bu·ªïi t·∫≠p n√†y</em></p>
          </ng-template>
          <p><strong>Th·ªùi gian:</strong> {{ d.startedAt | date:'dd/MM/yyyy HH:mm' }}</p>
        </div>
        <div class="detail-section">
          <h3>B√†i t·∫≠p ({{ d.items?.length || 0 }})</h3>
          <div class="exercise-item" *ngFor="let it of d.items">
            <div class="exercise-name"><strong>{{ it.equipment?.name || it.equipment }}</strong></div>
            <div class="exercise-meta">
              <span>Hi·ªáp: {{ it.sets }}</span>
              <span>L·∫∑p: {{ it.reps }}</span>
            </div>
          </div>
        </div>
      </div>
      <div mat-dialog-actions align="end">
        <button mat-button (click)="closeDetail()">ƒê√≥ng</button>
      </div>
    </div>
  </ng-template>

</div>
